{
  "Name": "le-boom",
  "SwarmID": "",
  "StackFileContent": "version: '3.8'\n\nservices:\n  # ================================\n  # PostgreSQL Database\n  # ================================\n  postgres:\n    image: postgres:16-alpine\n    container_name: boom-postgres\n    restart: unless-stopped\n    environment:\n      POSTGRES_DB: ${POSTGRES_DB:-boom_v2}\n      POSTGRES_USER: ${POSTGRES_USER:-boom_admin}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n      POSTGRES_INITDB_ARGS: \"--encoding=UTF8 --locale=C\"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    networks:\n      - boom-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER:-boom_admin} -d ${POSTGRES_DB:-boom_v2}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_period: 10s\n    deploy:\n      resources:\n        limits:\n          cpus: '2'\n          memory: 2G\n        reservations:\n          cpus: '1'\n          memory: 512M\n\n  # ================================\n  # Redis Cache\n  # ================================\n  redis:\n    image: redis:7-alpine\n    container_name: boom-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD}\n    volumes:\n      - redis_data:/data\n    networks:\n      - boom-network\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"--raw\", \"incr\", \"ping\"]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n    deploy:\n      resources:\n        limits:\n          cpus: '1'\n          memory: 512M\n        reservations:\n          cpus: '0.5'\n          memory: 256M\n\n  # ================================\n  # LE BOOM Web Application\n  # ================================\n  boom-webapp:\n    image: ghcr.io/boofactory/le-boom:main\n    container_name: boom-webapp\n    restart: unless-stopped\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    environment:\n      NODE_ENV: production\n      DATABASE_URL: postgresql://${POSTGRES_USER:-boom_admin}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB:-boom_v2}\n      REDIS_URL: redis://:${REDIS_PASSWORD}@redis:6379\n      NEXTAUTH_URL: ${NEXTAUTH_URL}\n      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET}\n      ADMIN_USERNAME: ${ADMIN_USERNAME:-boo-team}\n      ADMIN_PASSWORD_HASH: ${ADMIN_PASSWORD_HASH}\n      NOTION_API_TOKEN: ${NOTION_API_TOKEN}\n      NOTION_DATABASE_ID: ${NOTION_DATABASE_ID}\n      NEXT_TELEMETRY_DISABLED: 1\n      ENABLE_ANALYTICS: false\n      LOG_LEVEL: info\n      PHOTOMATON_1_IP: ${PHOTOMATON_1_IP}\n      PHOTOMATON_1_HOSTNAME: ${PHOTOMATON_1_HOSTNAME}\n      PHOTOMATON_1_ROUTER_IP: ${PHOTOMATON_1_ROUTER_IP}\n      PHOTOMATON_2_IP: ${PHOTOMATON_2_IP}\n      PHOTOMATON_2_HOSTNAME: ${PHOTOMATON_2_HOSTNAME}\n      PHOTOMATON_2_ROUTER_IP: ${PHOTOMATON_2_ROUTER_IP}\n    volumes:\n      - uploads_data:/app/public/uploads\n      - logs_data:/app/logs\n    ports:\n      - \"3001:3000\"\n    networks:\n      - boom-network\n      - nginx-proxy-manager_default\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:3000/api/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n    deploy:\n      resources:\n        limits:\n          cpus: '2'\n          memory: 2G\n        reservations:\n          cpus: '1'\n          memory: 1G\n    labels:\n      - \"com.centurylinklabs.watchtower.enable=true\"\n\nnetworks:\n  boom-network:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.24.0.0/16\n  nginx-proxy-manager_default:\n    external: true\n\nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n  uploads_data:\n    driver: local\n  logs_data:\n    driver: local\n",
  "Env": [
    {"name": "POSTGRES_DB", "value": "boom_v2"},
    {"name": "POSTGRES_USER", "value": "boom_admin"},
    {"name": "POSTGRES_PASSWORD", "value": "rWGjlkg757UOT2qxu5DHSsq4KAN2U9bK"},
    {"name": "REDIS_PASSWORD", "value": "QXTnonMyNjibMrDmghJVPpTEYWTSdMBZ"},
    {"name": "NEXTAUTH_URL", "value": "https://boom.boofactory.ch"},
    {"name": "NEXTAUTH_SECRET", "value": "93c3ee24db2e110595384c98d2c05805b5bac448f199c9bd8717d9fb8adced5b"},
    {"name": "ADMIN_USERNAME", "value": "boo-team"},
    {"name": "ADMIN_PASSWORD_HASH", "value": "$2b$10$UQ5V.yZ3xHzGvK8LmJ9wEeXH7qNx2yKj9xP1wF4mK8L5vN6pH7tQS"},
    {"name": "NOTION_API_TOKEN", "value": "placeholder_update_later"},
    {"name": "NOTION_DATABASE_ID", "value": "4e70a95f1aa740c9a9beabfb5bea9e00"},
    {"name": "PHOTOMATON_1_IP", "value": "100.119.216.41"},
    {"name": "PHOTOMATON_1_HOSTNAME", "value": "boofactory-boo1"},
    {"name": "PHOTOMATON_1_ROUTER_IP", "value": "100.82.102.117"},
    {"name": "PHOTOMATON_2_IP", "value": "100.107.171.80"},
    {"name": "PHOTOMATON_2_HOSTNAME", "value": "boofactory-boo2"},
    {"name": "PHOTOMATON_2_ROUTER_IP", "value": "100.116.97.112"}
  ]
}
